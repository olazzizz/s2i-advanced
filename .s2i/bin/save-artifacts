#!/bin/bash
set -e  # Exit on error

# This script is responsible for tar'ing dependencies
# so they can be used in the next build
echo "---> Saving build artifacts"

# Create a dummy file if node_modules is not present
if [ ! -d "./node_modules" ]; then
  echo "---> No node_modules directory found"
  # Create an empty but valid tar file with a marker file
  mkdir -p /tmp/dummy
  touch /tmp/dummy/marker
  tar -C /tmp/dummy -cf - .
  rm -rf /tmp/dummy
  exit 0
fi

# If node_modules exists, tar it up
pushd ${HOME} > /dev/null
if [ -d "./node_modules" ] && [ "$(ls -A ./node_modules 2>/dev/null)" ]; then
  echo "---> Packaging node_modules"
  # Create archive of dependencies
  tar -cf artifacts.tar ./node_modules
fi
popd > /dev/null
